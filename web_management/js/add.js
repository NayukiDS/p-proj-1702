var location_obj = [
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "101"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "102"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "103"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "104"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "105"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "106"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "107"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "108"
    },{
        candidate_title: "第三教学楼",
        candidate_title_child: "109"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "110"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "111"
    },{
        candidate_title: "第三教学楼",
        candidate_title_child: "112"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "113"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "201"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "202"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "203"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "204"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "205"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "206"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "207"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "208"
    },{
        candidate_title: "第三教学楼",
        candidate_title_child: "209"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "211"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "211"
    },{
        candidate_title: "第三教学楼",
        candidate_title_child: "212"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "213"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "301"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "302"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "303"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "304"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "305"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "306"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "307"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "308"
    },{
        candidate_title: "第三教学楼",
        candidate_title_child: "309"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "310"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "311"
    },{
        candidate_title: "第三教学楼",
        candidate_title_child: "312"
    },
    {
        candidate_title: "第三教学楼",
        candidate_title_child: "313"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "101"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "102"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "103"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "104"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "105"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "106"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "107"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "108"
    },{
        candidate_title: "第二教学楼",
        candidate_title_child: "109"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "110"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "111"
    },{
        candidate_title: "第二教学楼",
        candidate_title_child: "112"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "113"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "201"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "202"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "203"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "204"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "205"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "206"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "207"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "208"
    },{
        candidate_title: "第二教学楼",
        candidate_title_child: "209"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "211"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "211"
    },{
        candidate_title: "第二教学楼",
        candidate_title_child: "212"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "213"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "301"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "302"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "303"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "304"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "305"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "306"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "307"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "308"
    },{
        candidate_title: "第二教学楼",
        candidate_title_child: "309"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "310"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "311"
    },{
        candidate_title: "第二教学楼",
        candidate_title_child: "312"
    },
    {
        candidate_title: "第二教学楼",
        candidate_title_child: "313"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "101"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "102"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "103"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "104"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "105"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "106"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "107"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "201"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "202"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "203"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "204"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "205"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "206"
    },
    {
        candidate_title: "综合楼",
        candidate_title_child: "207"
    }
];
var teacher_name_obj = [
    {
        candidate_title: "黄静",
        candidate_title_child: "108015"
    },
    {
        candidate_title: "张丽珩",
        candidate_title_child: "108004"
    },
    {
        candidate_title: "李文正",
        candidate_title_child: "108003"
    },
    {
        candidate_title: "郑鲲",
        candidate_title_child: "108002"
    },
    {
        candidate_title: "郑全英",
        candidate_title_child: "108014"
    },
    {
        candidate_title: "王卓峥",
        candidate_title_child: "118001"
    }
];
var teacher_id_obj = [
    {
        candidate_title: "108015",
        candidate_title_child: "黄静"
    },
    {
        candidate_title: "108004",
        candidate_title_child: "张丽珩"
    },
    {
        candidate_title: "108003",
        candidate_title_child: "李文正"
    },
    {
        candidate_title: "108002",
        candidate_title_child: "郑鲲"
    },
    {
        candidate_title: "108014",
        candidate_title_child: "郑全英"
    },
    {
        candidate_title: "118001",
        candidate_title_child: "王卓峥"
    }
];
var semester_obj = [
    {
        candidate_title: "201702",
        candidate_title_info: "2017-2018 第二学期"
    },
    {
        candidate_title: "201701",
        candidate_title_info: "2017-2018 第二学期"
    },
    {
        candidate_title: "201602",
        candidate_title_info: "2016-2017 第二学期"
    },
    {
        candidate_title: "201601",
        candidate_title_info: "2016-2017 第二学期"
    },
    {
        candidate_title: "201502",
        candidate_title_info: "2015-2016 第一学期"
    },
    {
        candidate_title: "201501",
        candidate_title_info: "2015-2016 第二学期"
    }
];

function event_reg(str) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', server_http + '://' + server_address
        + '/p-proj-1702/event_search?keyword='+ str +'&filter_semester=201602&filter_type=4', true);
    xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');

    xhr.onreadystatechange = function () {
        if(xhr.readyState === 4){
            if(xhr.status === 200){
                var res_data = JSON.parse(this.response);
                return res_data;
            }
        }
    };
    xhr.send();
}

function location_reg(str) {
    var str_array = str.split(" ");
    var str_reg;
    var res_obj = [];
    str_reg = new RegExp("","i")
    // console.log(str_reg.match())
    var target_obj = location_obj;
    target_obj.forEach(function(value, index){
        var str_match = value.candidate_title + value.candidate_title_child;
        var ok_obj = [];
        str_array.forEach(function (v, i) {
            if(str_match.match(v)){
                ok_obj[i] = true;
            }else{
                ok_obj[i] = false;
            }
        });
        var ok = true;
        if(ok_obj.length===0)ok=false;
        for(var i=0;i<ok_obj.length;i++){
            if(!ok_obj[i])ok = false;
        }
        if(ok){
            res_obj.push(value);
        }
    });
    return res_obj;
}

function t_name_reg(str) {
    var str_array = str.split(" ");
    var str_reg;
    var res_obj = [];
    str_reg = new RegExp("","i");
    // console.log(str_reg.match())
    var target_obj = teacher_name_obj;
    target_obj.forEach(function(value, index){
        var str_match = value.candidate_title + value.candidate_title_child;
        var ok_obj = [];
        str_array.forEach(function (v, i) {
            if(str_match.match(v)){
                ok_obj[i] = true;
            }else{
                ok_obj[i] = false;
            }
        });
        var ok = true;
        if(ok_obj.length===0)ok=false;
        for(var i=0;i<ok_obj.length;i++){
            if(!ok_obj[i])ok = false;
        }
        if(ok){
            res_obj.push(value);
        }
    });
    return res_obj;
}

function t_id_reg(str) {
    var str_array = str.split(" ");
    var str_reg;
    var res_obj = [];
    str_reg = new RegExp("","i");
    // console.log(str_reg.match())
    var target_obj = teacher_id_obj;
    target_obj.forEach(function(value, index){
        var str_match = value.candidate_title + value.candidate_title_child;
        var ok_obj = [];
        str_array.forEach(function (v, i) {
            if(str_match.match(v)){
                ok_obj[i] = true;
            }else{
                ok_obj[i] = false;
            }
        });
        var ok = true;
        if(ok_obj.length===0)ok=false;
        for(var i=0;i<ok_obj.length;i++){
            if(!ok_obj[i])ok = false;
        }
        if(ok){
            res_obj.push(value);
        }
    });
    return res_obj;
}

function semester_reg(str) {
    var str_array = str.split(" ");
    var str_reg;
    var res_obj = [];
    str_reg = new RegExp("","i");
    // console.log(str_reg.match())
    var target_obj = semester_obj;
    target_obj.forEach(function(value, index){
        var str_match = value.candidate_title + value.candidate_title_info;
        var ok_obj = [];
        str_array.forEach(function (v, i) {
            if(str_match.match(v)){
                ok_obj[i] = true;
            }else{
                ok_obj[i] = false;
            }
        });
        var ok = true;
        if(ok_obj.length===0)ok=false;
        for(var i=0;i<ok_obj.length;i++){
            if(!ok_obj[i])ok = false;
        }
        if(ok){
            res_obj.push(value);
        }
    });
    return res_obj;
}

var can_panel = $('#candidate_panel');

function event_change(str) {
    if(!str){
        can_panel.html("");
        return false;
    }
    // var obj = event_reg(str);
    var xhr = new XMLHttpRequest();
    xhr.open('GET', server_http + '://' + server_address
        + '/p-proj-1702/event_search?keyword='+ str +'&filter_semester=201602&filter_type=4', true);
    xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');

    xhr.onreadystatechange = function () {
        if(xhr.readyState === 4){
            if(xhr.status === 200){
                var res_data = JSON.parse(this.response);
                var obj = res_data;
                can_panel.html("");
                if(!obj)return false;
                obj.forEach(function (value, index) {
                    var s_obj = semester_reg(value.semester.toString());
                    var str_title = value.name;
                    var str_title_child = value.holder_name;
                    var str =
                        "            <div class=\"candidate_single\">\n" +
                        "                <div class=\"candidate_title\">"+ str_title +"</div>\n" +
                        "                <div class=\"candidate_title_child\">" + str_title_child + "</div>\n" +
                        "                <div class=\"candidate_title_info\">"+ s_obj[0].candidate_title_info +"</div>\n" +
                        "                <div class=\"candidate_cover\"></div>\n" +
                        "            </div>";
                    can_panel.append(str);
                    var add_obj = can_panel.children();
                    add_obj = ($(add_obj[add_obj.length-1]));
                    add_obj.attr("event_name", value.name);
                    add_obj.attr("holder_id", value.holder_id);
                    add_obj.attr("holder_name", value.holder_name);
                    var json_str = JSON.stringify(value.schedule);
                    json_str = encodeURIComponent(json_str);
                    add_obj.attr("schedule", json_str);
                });
            }
        }
    };
    xhr.send();
}

function location_change(str) {
    var obj = location_reg(str);
    can_panel.html("");
    obj.forEach(function (value, index) {
        var str_title = value.candidate_title;
        var str_title_child = value.candidate_title_child;
        var str =
            "            <div class=\"candidate_single\">\n" +
            "                <div class=\"candidate_title\">"+ str_title +"</div>\n" +
            "                <div class=\"candidate_title_child\">" + str_title_child + "</div>\n" +
            "                <div class=\"candidate_title_info\"></div>\n" +
            "                <div class=\"candidate_cover\"></div>\n" +
            "            </div>";
        can_panel.append(str);
    });
}

function t_name_change(str) {
    var obj = t_name_reg(str);
    can_panel.html("");
    obj.forEach(function (value, index) {
        var str_title = value.candidate_title;
        var str_title_child = value.candidate_title_child;
        var str =
            "            <div class=\"candidate_single\">\n" +
            "                <div class=\"candidate_title\">"+ str_title +"</div>\n" +
            "                <div class=\"candidate_title_child\">" + str_title_child + "</div>\n" +
            "                <div class=\"candidate_title_info\"></div>\n" +
            "                <div class=\"candidate_cover\"></div>\n" +
            "            </div>";
        can_panel.append(str);
    });
}

function t_id_change(str) {
    var obj = t_id_reg(str);
    can_panel.html("");
    obj.forEach(function (value, index) {
        var str_title = value.candidate_title;
        var str_title_child = value.candidate_title_child;
        var str =
            "            <div class=\"candidate_single\">\n" +
            "                <div class=\"candidate_title\">"+ str_title +"</div>\n" +
            "                <div class=\"candidate_title_child\">" + str_title_child + "</div>\n" +
            "                <div class=\"candidate_title_info\"></div>\n" +
            "                <div class=\"candidate_cover\"></div>\n" +
            "            </div>";
        can_panel.append(str);
    });
}

function semester_change(str) {
    var obj = semester_reg(str);
    can_panel.html("");
    obj.forEach(function (value, index) {
        var str_title = value.candidate_title;
        var str_title_info = value.candidate_title_info;
        var str =
            "            <div class=\"candidate_single\">\n" +
            "                <div class=\"candidate_title\">"+ str_title +"</div>\n" +
            "                <div class=\"candidate_title_child\"></div>\n" +
            "                <div class=\"candidate_title_info\">" + str_title_info + "</div>\n" +
            "                <div class=\"candidate_cover\"></div>\n" +
            "            </div>";
        can_panel.append(str);
    });
}

